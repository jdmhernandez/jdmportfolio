---
/**
 * ScrollReveal - IntersectionObserver-based scroll animations
 * Mobile-safe, 60fps, respects reduced-motion preferences
 * 
 * Usage: Add class="reveal" to any element you want to animate on scroll
 * Optional: Add reveal-delay-1, reveal-delay-2, etc. for staggered animations
 */
---

<script>
  // Initialize scroll reveal on page load and view transitions
  function initScrollReveal() {
    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    
    if (prefersReducedMotion) {
      // If user prefers reduced motion, reveal all elements immediately
      document.querySelectorAll('.reveal').forEach(el => {
        el.classList.add('revealed');
      });
      return;
    }

    // Create IntersectionObserver for scroll animations
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('revealed');
            // Unobserve after revealing (one-time animation)
            observer.unobserve(entry.target);
          }
        });
      },
      {
        // Trigger when element is 10% visible
        threshold: 0.1,
        // Start animation slightly before element enters viewport
        rootMargin: '0px 0px -50px 0px',
      }
    );

    // Observe all elements with the reveal class
    document.querySelectorAll('.reveal').forEach((el) => {
      observer.observe(el);
    });
  }

  // Initialize on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initScrollReveal);
  } else {
    initScrollReveal();
  }

  // Re-initialize after Astro view transitions
  document.addEventListener('astro:after-swap', initScrollReveal);
</script>
