---
// Theme provider script that handles theme initialization and persistence
---

<script define:vars={{ theme: "light" }}>
  // Theme management
  class ThemeManager {
    constructor() {
      this.init();
    }

    init() {
      // Get saved theme or default to light
      const savedTheme = localStorage.getItem('theme') || 'light';

      // Apply theme immediately
      this.applyTheme(savedTheme);

      // Listen for system theme changes
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        // Only auto-switch if no manual preference is saved
        if (!localStorage.getItem('theme')) {
          this.applyTheme(e.matches ? 'dark' : 'light');
        }
      });
    }

    applyTheme(theme) {
      const root = document.documentElement;

      if (theme === 'dark') {
        root.classList.add('dark');
      } else {
        root.classList.remove('dark');
      }

      // Update meta theme-color
      const metaThemeColor = document.querySelector('meta[name="theme-color"]');
      if (metaThemeColor) {
        metaThemeColor.setAttribute('content', theme === 'dark' ? '#000000' : '#ffffff');
      }
    }

    toggle() {
      const currentTheme = localStorage.getItem('theme') || 'light';
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      localStorage.setItem('theme', newTheme);
      this.applyTheme(newTheme);

      return newTheme;
    }

    getCurrentTheme() {
      return localStorage.getItem('theme') || 'light';
    }
  }

  // Make theme manager globally available
  window.themeManager = new ThemeManager();
</script>
